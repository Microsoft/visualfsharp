
language: csharp

sudo: required
dist: trusty

env:
  - BUILD_NET40=1 TEST_NET40_COREUNIT_SUITE=1 TEST_NET40_FSHARP_SUITE=1 
  - BUILD_CORECLR=1 TEST_CORECLR_COREUNIT_SUITE=1
  - BUILD_CORECLR=1 TEST_CORECLR_COREUNIT_SUITE=1 BUILD_PROTO_WITH_CORECLR_LKG=1

before_install:
  - sudo sh -c 'echo "deb [arch=amd64] https://apt-mo.trafficmanager.net/repos/dotnet-release/ trusty main" > /etc/apt/sources.list.d/dotnetdev.list'
  - sudo apt-key adv --keyserver apt-mo.trafficmanager.net --recv-keys 417A0893
  - sudo apt-get update
  - sudo apt-get install dotnet-dev-1.0.0-preview2-003131

script:
  - (mono .nuget/NuGet.exe restore packages.config -PackagesDirectory packages -ConfigFile .nuget/NuGet.Config || true)
  - (cd tests/fsharp; mono ../../.nuget/NuGet.exe restore  project.json -PackagesDirectory ../../packages -ConfigFile ../../.nuget/NuGet.Config)
  - (if test x-$BUILD_CORECLR = x-1; then ./init-tools.sh; cat ./init-tools.log; ls -RFlas ../Tools; fi)
  - (if test x-$BUILD_PROTO_WITH_CORECLR_LKG = x-1; then cd lkg &&  dotnet restore --packages ../packages && dotnet publish project.json -o ../Tools/lkg -r ubuntu.14.04-x64 && ls -RFlas ../Tools  && ls -RFlas ../packages; fi)
  - xbuild src/fsharp-proto-build.proj
  - xbuild build-everything.proj /p:Configuration=debug /p:BUILD_PUBLICSIGN=0


  



