<Project>
  <Import Project="Sdk.targets" Sdk="Microsoft.DotNet.Arcade.Sdk" />
  <Import Project="eng\targets\NuGet.targets" />
  <Import Project="eng\targets\NGenBinaries.targets" />
  <Import Project="FSharp.Profiles.props" />

  <Target Name="CopyAndSubstituteTextFiles"
          Inputs="@(CopyAndSubstituteText)"
          Outputs="@(CopyAndSubstituteText->'$(OutDir)%(Filename)%(Extension)')"
          BeforeTargets="BeforeBuild">

    <PropertyGroup>
      <_ReplacementText>$([System.IO.File]::ReadAllText('%(CopyAndSubstituteText.FullPath)'))</_ReplacementText>
      <_ReplacementText Condition="'%(CopyAndSubstituteText.Pattern1)' != ''">$(_ReplacementText.Replace('%(CopyAndSubstituteText.Pattern1)', '%(CopyAndSubstituteText.Replacement1)'))</_ReplacementText>
      <_ReplacementText Condition="'%(CopyAndSubstituteText.Pattern2)' != ''">$(_ReplacementText.Replace('%(CopyAndSubstituteText.Pattern2)', '%(CopyAndSubstituteText.Replacement2)'))</_ReplacementText>
      <_ReplacementText Condition="'%(CopyAndSubstituteText.Pattern3)' != ''">$(_ReplacementText.Replace('%(CopyAndSubstituteText.Pattern3)', '%(CopyAndSubstituteText.Replacement3)'))</_ReplacementText>
      <_ReplacementText Condition="'%(CopyAndSubstituteText.Pattern4)' != ''">$(_ReplacementText.Replace('%(CopyAndSubstituteText.Pattern4)', '%(CopyAndSubstituteText.Replacement4)'))</_ReplacementText>
      <_ReplacementText Condition="'%(CopyAndSubstituteText.Pattern5)' != ''">$(_ReplacementText.Replace('%(CopyAndSubstituteText.Pattern5)', '%(CopyAndSubstituteText.Replacement5)'))</_ReplacementText>
      <_ReplacementText Condition="'%(CopyAndSubstituteText.Pattern6)' != ''">$(_ReplacementText.Replace('%(CopyAndSubstituteText.Pattern6)', '%(CopyAndSubstituteText.Replacement6)'))</_ReplacementText>
      <_ReplacementText Condition="'%(CopyAndSubstituteText.Pattern7)' != ''">$(_ReplacementText.Replace('%(CopyAndSubstituteText.Pattern7)', '%(CopyAndSubstituteText.Replacement7)'))</_ReplacementText>
      <_ReplacementText Condition="'%(CopyAndSubstituteText.Pattern8)' != ''">$(_ReplacementText.Replace('%(CopyAndSubstituteText.Pattern8)', '%(CopyAndSubstituteText.Replacement8)'))</_ReplacementText>
      <_ReplacementText Condition="'%(CopyAndSubstituteText.Pattern9)' != ''">$(_ReplacementText.Replace('%(CopyAndSubstituteText.Pattern9)', '%(CopyAndSubstituteText.Replacement9)'))</_ReplacementText>
    </PropertyGroup>

    <WriteLinesToFile File="@(CopyAndSubstituteText->'$(OutDir)%(Filename)%(Extension)')" Lines="$(_ReplacementText)" Overwrite="true" />

    <!-- Make sure it will get cleaned  -->
    <ItemGroup>
        <None Include="@(CopyAndSubstituteText->'$(OutDir)%(Filename)%(Extension)')" CopyToOutputDirectory="PreserveNewest" />
    </ItemGroup>
    <CreateItem Include="@(CopyAndSubstituteText->'$(OutDir)%(Filename)%(Extension)')">
      <Output TaskParameter="Include" ItemName="FileWrites" />
    </CreateItem>
  </Target>

</Project>
